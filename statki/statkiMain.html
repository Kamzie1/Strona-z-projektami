<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="cssStatki.css" rel="stylesheet"/>
<title>Manual do gry w statki</title>
</head>
<body>
<div class="panel">
  <table>
    <tr>
      <td><img class="strzalka" id="strzalka" src="images/strzalka.jpg" alt="strzalka"></td>
      <td><h1>Już nigdy nie przegrasz w grze statki!</h1></td>
      <td><img class="settings" id="settings" src="images/settings.jpg" alt="settings"></td>
    </tr>
  </table>
<hr>
<section class="dane">
    <form name="data">
        <label for="strzal">współrzędne strzału</label>
        <input type="text" id="strzal" ><br>
        <label for="trafienie">trafienie</label>
        <input type="text" id="trafienie" ><br>
        <button class="button" id="update">update</button> 
    </form>
</section>
<section>
  <div class="board">
    <table id="gameBoard"></table>
  </div>
</section>
<section>
  <div id="print">

  </div>
</section>
<script>
document.getElementById('strzalka').addEventListener('click', function() {
  window.location.href = '../main.html';
});
document.getElementById('settings').addEventListener('click', function() {
  window.location.href = 'statkiSettings.html';
});

let array = [];
let cells = [];

function setup(rows) {
  const table = document.getElementById('gameBoard');
  table.innerHTML = '';

  for (let i = 0; i < rows; i++) {
    const tr = document.createElement('tr');
    const td = document.createElement('td');
    td.textContent = String.fromCharCode(65 + i);
    tr.appendChild(td);
    for (let j = 0; j < rows; j++) {
      const td = document.createElement('td');
      td.textContent = '';
      tr.appendChild(td);
    }
    table.appendChild(tr);
  }

  const tr = document.createElement('tr');
  tr.appendChild(document.createElement('td')); 
  for (let x = 1; x <= rows; x++) {
    const td = document.createElement('td');
    td.textContent = x;
    tr.appendChild(td);
  }
  table.appendChild(tr);

  for (let i = 0; i < rows; i++) {
    array.push(Array(rows).fill(''));
  }
}

function cell_to_num(a) {
  let rows = a.charAt(0).charCodeAt(0) - 65; 
  let columns = parseInt(a.substring(1)) - 1;
  return { rows, columns };
}

function num_to_cell(rows, columns) {
  var cell = String.fromCharCode(rows + 65) + (columns).toString();
  return cell;
}

function fire(table, a, b) {
  if (a) {
    let coordinatesA = cell_to_num(a);
    table[coordinatesA.rows][coordinatesA.columns] = '#';
  }
  
  if (b) {
    let coordinatesB = cell_to_num(b);
    table[coordinatesB.rows][coordinatesB.columns] = '*';
  }
}

function displayArray() {
  let printDiv = document.getElementById("print");
  printDiv.innerHTML = ''; 
  for(let i=0;i<2;i++)
  {
    for(let j=0;j<2;j++)
    {
      printDiv.innerHTML += array[i][j]; 
    }
  }
  };

function in_cell_array(a)
{
  for(let i=0;i<cells.length;i++)
  {
    if(a==cells[i])
      return false;
  }
  return true;
}

function count(a, rows)
{

  for(let i=0;i<rows;i++)
  {
    for(let j=0;j<rows;j++)
    {
        if(array[i][j]=='#'||array[i][j]=='*')
          continue;     
        if(i-1>0&&in_cell_array(num_to_cell(i-1, j))&&(array[i-1][j]!='#'||array[i-1][j]!='*'))
        {
          array[i][j]+=1;
          array[i-1][j]+=1;
        }
        if(i+1<rows&&in_cell_array(num_to_cell(i+1, j))&&(array[i+1][j]!='#'||array[i-1][j]!='*'))
        {
          array[i][j]+=1;
          array[i+1][j]+=1;
        }
        if(j+1<rows&&in_cell_array(num_to_cell(i, j+1))&&(array[i][j+1]!='#'||array[i-1][j]!='*'))
        {
          array[i][j]+=1;
          array[i][j+1]+=1;
        }
        if(j-1<0&&in_cell_array(num_to_cell(i, j-1))&&(array[i][j-1]!='#'||array[i-1][j]!='*'))
        {
          array[i][j]+=1;
          array[i][j-1]+=1;
        }
        cells.push(num_to_cell(i, j));
    }
  }
  cells=[];
}


document.getElementById('update').addEventListener('click', function() {
  let strzal = document.getElementById('strzal').value;
  let trafienie = document.getElementById('trafienie').value;
  fire(array, strzal, trafienie); 
  displayArray();
  count(2, 2); //liczy prawdopodobieństwo występowania statku o mwielkości dwa kratki w tablicy 2
});

window.onload = function() {
  setup(2); 
};
</script>
